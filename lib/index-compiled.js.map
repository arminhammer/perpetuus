{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;mBACY,KAAK;;;;;uBAGL,SAAS;;IAAtB,OAAO;;sBACK,QAAQ;;;;;IAApB,MAAM;;AAKlB,IAAI,MAAM,GAAG;AACX,WAAS,EAAE,yCAAyC;AACpD,MAAI,EAAE,GAAG;AACT,QAAM,EAAE,QAAQ;AAChB,cAAY,EAAE;AACZ,SAAK,EAAE;AACL,UAAI,EAAE,KAAK;AACX,YAAM,EAAE,QAAQ;KACjB;AACD,WAAO,EAAE;AACP,UAAI,EAAE,OAAO;AACb,YAAM,EAAE,OAAO;AACf,aAAO,EAAE;AACP,YAAI,EAAE,GAAG;AACT,cAAM,EAAE,QAAQ;AAChB,oBAAY,EAAE;AACZ,mBAAS,EAAE;AACT,gBAAI,EAAE,SAAS;AACf,kBAAM,EAAE,QAAQ;WACjB;AACD,eAAK,EAAE;AACL,gBAAI,EAAE,KAAK;AACX,kBAAM,EAAE,QAAQ;WACjB;SACF;OACF;KACF;AACD,YAAQ,EAAE;AACR,UAAI,EAAE,QAAQ;AACd,YAAM,EAAE,QAAQ;AAChB,kBAAY,EAAE;AACZ,gBAAQ,EAAE;AACR,cAAI,EAAE,QAAQ;AACd,gBAAM,EAAE,QAAQ;AAChB,sBAAY,EAAE;AACZ,mBAAO,EAAE;AACP,kBAAI,EAAE,OAAO;AACb,oBAAM,EAAE,QAAQ;aACjB;WACF;SACF;AACD,aAAK,EAAE;AACL,cAAI,EAAE,KAAK;AACX,gBAAM,EAAE,QAAQ;AAChB,sBAAY,EAAE;AACZ,mBAAO,EAAE;AACP,kBAAI,EAAE,OAAO;AACb,oBAAM,EAAE,QAAQ;aACjB;WACF;SACF;OACF;KACF;GACF;AACD,YAAU,EAAE,CACV,KAAK,CACN;CACF,CAAC;;AAEF,IAAI,aAAa,GAAG,SAAhB,aAAa,CAAY,QAAQ,EAAE;;AAErC,MAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;;AAElD,UAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,UAAS,KAAK,EAAE,QAAQ,EAAE;AACjD,UAAI,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;AACzB,UAAI,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACpC,aAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;KACnB,CAAC,CAAC;GAEJ,CAAC,CAAC;;AAEH,SAAO,OAAO,CAAC;CAEhB,CAAC;;AAEF,IAAI,gBAAgB,GAAG,SAAnB,gBAAgB,CAAY,QAAQ,EAAE;AACxC,SAAO,SArFA,QAAQ,EAqFC,QAAQ,EAAE,MAAM,CAAC,CAAC;CACnC,CAAC;;AAEF,IAAI,MAAM,GAAG,SAAT,MAAM,CAAY,QAAQ,EAAE;;;;;AAK9B,MAAI,OAAO,GAAG,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;;AAElD,QAAI,KAAK,GAAG,gBAAgB,CAAC,QAAQ,CAAC,CAAC;AACvC,WAAO,CAAC,GAAG,CAAC,SAAS,GAAG,KAAK,CAAC,CAAC;AAC/B,QAAG,CAAC,KAAK,EAAE;AAAE,YAAM,CAAC,KAAK,CAAC,CAAC;KAAE,CAAC;;AAE9B,iBAAa,CAAC,QAAQ,CAAC,CACpB,IAAI,CAAC,UAAS,IAAI,EAAE;AACnB,aAAO,CAAC,IAAI,CAAC,CAAC;KACf,CAAC,CAAC;GAEN,CAAC,CAAC;;AAEH,SAAO,OAAO,CAAC;CAEhB,CAAC;;qBAEa,EAAE,MAAM,EAAN,MAAM,EAAE","file":"index-compiled.js","sourcesContent":["'use strict';\nimport { validate } from 'tv4';\n//var schema = require('schema.json');\n//import * as schema from 'schema.json';\nimport * as cheerio from 'cheerio';\nimport * as needle from 'needle';\n\n//console.log('Schema:');\n//console.log(schema);\n\nvar schema = {\n  \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n  \"id\": \"/\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"url\": {\n      \"id\": \"url\",\n      \"type\": \"string\"\n    },\n    \"input\": {\n      \"id\": \"input\",\n      \"type\": \"array\",\n      \"items\": {\n        \"id\": \"0\",\n        \"type\": \"object\",\n        \"properties\": {\n          \"element\": {\n            \"id\": \"element\",\n            \"type\": \"string\"\n          },\n          \"val\": {\n            \"id\": \"val\",\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"follow\": {\n      \"id\": \"follow\",\n      \"type\": \"object\",\n      \"properties\": {\n        \"method\": {\n          \"id\": \"method\",\n          \"type\": \"object\",\n          \"properties\": {\n            \"click\": {\n              \"id\": \"click\",\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"val\": {\n          \"id\": \"val\",\n          \"type\": \"object\",\n          \"properties\": {\n            \"links\": {\n              \"id\": \"links\",\n              \"type\": \"string\"\n            }\n          }\n        }\n      }\n    }\n  },\n  \"required\": [\n    \"url\"\n  ]\n};\n\nvar cheerioDriver = function(template) {\n\n  var promise = new Promise(function(resolve, reject) {\n\n    needle.get(template.url, function(error, response) {\n      if (error) reject(error);\n      var $ = cheerio.load(response.body);\n      resolve($.html());\n    });\n\n  });\n\n  return promise;\n\n};\n\nvar validateTemplate = function(template) {\n  return validate(template, schema);\n};\n\nvar scrape = function(template) {\n\n  //var driver;\n  //if(!template.driver) driver = 'cheerio';\n\n  var promise = new Promise(function(resolve, reject) {\n\n    var valid = validateTemplate(template);\n    console.log('valid: ' + valid);\n    if(!valid) { reject(valid); };\n\n    cheerioDriver(template)\n      .then(function(data) {\n        resolve(data);\n      });\n\n  });\n\n  return promise;\n\n};\n\nexport default { scrape };\n"]}